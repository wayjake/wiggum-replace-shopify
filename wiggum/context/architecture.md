# ğŸ—ï¸ Architecture Overview

```
    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
    â”‚                           THE BIG PICTURE                                    â”‚
    â”‚                                                                              â”‚
    â”‚   â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”‚
    â”‚   â”‚   Browser   â”‚â”€â”€â”€â–¶â”‚  TanStack   â”‚â”€â”€â”€â–¶â”‚   Turso     â”‚    â”‚   Brevo     â”‚  â”‚
    â”‚   â”‚   (React)   â”‚â—€â”€â”€â”€â”‚   Start     â”‚â—€â”€â”€â”€â”‚   (SQLite)  â”‚    â”‚   (Email)   â”‚  â”‚
    â”‚   â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â”‚
    â”‚         â”‚                   â”‚                  â–²                  â–²          â”‚
    â”‚         â”‚                   â”‚                  â”‚                  â”‚          â”‚
    â”‚         â–¼                   â–¼                  â”‚                  â”‚          â”‚
    â”‚   â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”‚
    â”‚   â”‚   Stripe    â”‚â—€â”€â”€â–¶â”‚   Drizzle   â”‚â”€â”€â”€â–¶â”‚ Migrations  â”‚    â”‚  Inngest    â”‚  â”‚
    â”‚   â”‚  (Tuition)  â”‚    â”‚   (ORM)     â”‚    â”‚   (Auto)    â”‚    â”‚  (Events)   â”‚  â”‚
    â”‚   â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â”‚
    â”‚         â”‚                                                        â”‚          â”‚
    â”‚         â”‚              â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”                          â”‚          â”‚
    â”‚         â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â–¶â”‚   Session   â”‚â—€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜          â”‚
    â”‚                        â”‚   (Auth)    â”‚                                      â”‚
    â”‚                        â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜                                      â”‚
    â”‚                                                                              â”‚
    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

---

## ğŸ  Core Data Model: Household-Centric Architecture

```
    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
    â”‚                     HOUSEHOLD-CENTRIC DATA MODEL                             â”‚
    â”‚                                                                              â”‚
    â”‚   â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”    â”‚
    â”‚   â”‚                        HOUSEHOLD                                    â”‚    â”‚
    â”‚   â”‚   The billing unit. One household = one bill.                      â”‚    â”‚
    â”‚   â”‚                                                                     â”‚    â”‚
    â”‚   â”‚   â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”‚    â”‚
    â”‚   â”‚   â”‚  Addresses    â”‚  â”‚ Payment       â”‚  â”‚    Ledger             â”‚  â”‚    â”‚
    â”‚   â”‚   â”‚  (billing,    â”‚  â”‚ Methods       â”‚  â”‚    (charges,          â”‚  â”‚    â”‚
    â”‚   â”‚   â”‚   shipping)   â”‚  â”‚ (cards, ACH)  â”‚  â”‚     payments)         â”‚  â”‚    â”‚
    â”‚   â”‚   â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â”‚    â”‚
    â”‚   â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜    â”‚
    â”‚                                   â”‚                                          â”‚
    â”‚          â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”                â”‚
    â”‚          â”‚                        â”‚                        â”‚                â”‚
    â”‚          â–¼                        â–¼                        â–¼                â”‚
    â”‚   â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”          â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”          â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”        â”‚
    â”‚   â”‚  Guardian 1 â”‚          â”‚  Guardian 2 â”‚          â”‚  Guardian N â”‚        â”‚
    â”‚   â”‚  (Parent A) â”‚          â”‚  (Parent B) â”‚          â”‚  (Other)    â”‚        â”‚
    â”‚   â”‚             â”‚          â”‚             â”‚          â”‚             â”‚        â”‚
    â”‚   â”‚  â€¢ Email    â”‚          â”‚  â€¢ Email    â”‚          â”‚  â€¢ Email    â”‚        â”‚
    â”‚   â”‚  â€¢ Phone    â”‚          â”‚  â€¢ Phone    â”‚          â”‚  â€¢ Phone    â”‚        â”‚
    â”‚   â”‚  â€¢ Role     â”‚          â”‚  â€¢ Role     â”‚          â”‚  â€¢ Role     â”‚        â”‚
    â”‚   â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜          â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜          â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜        â”‚
    â”‚                                                                              â”‚
    â”‚          â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”                â”‚
    â”‚          â”‚                        â”‚                        â”‚                â”‚
    â”‚          â–¼                        â–¼                        â–¼                â”‚
    â”‚   â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”          â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”          â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”        â”‚
    â”‚   â”‚  Student 1  â”‚          â”‚  Student 2  â”‚          â”‚  Student N  â”‚        â”‚
    â”‚   â”‚  (Child A)  â”‚          â”‚  (Child B)  â”‚          â”‚  (Sibling)  â”‚        â”‚
    â”‚   â”‚             â”‚          â”‚             â”‚          â”‚             â”‚        â”‚
    â”‚   â”‚  â€¢ Grade    â”‚          â”‚  â€¢ Grade    â”‚          â”‚  â€¢ Grade    â”‚        â”‚
    â”‚   â”‚  â€¢ Status   â”‚          â”‚  â€¢ Status   â”‚          â”‚  â€¢ Status   â”‚        â”‚
    â”‚   â”‚  â€¢ App      â”‚          â”‚  â€¢ App      â”‚          â”‚  â€¢ App      â”‚        â”‚
    â”‚   â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜          â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜          â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜        â”‚
    â”‚                                                                              â”‚
    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

### Split Custody Model

```
    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
    â”‚                     SHARED CUSTODY ARCHITECTURE                              â”‚
    â”‚                                                                              â”‚
    â”‚   When parents are divorced/separated, a student can belong to              â”‚
    â”‚   multiple households. Each household handles its own billing.              â”‚
    â”‚                                                                              â”‚
    â”‚   â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”                    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”            â”‚
    â”‚   â”‚   HOUSEHOLD A      â”‚                    â”‚   HOUSEHOLD B      â”‚            â”‚
    â”‚   â”‚   (Mom's Address)  â”‚                    â”‚   (Dad's Address)  â”‚            â”‚
    â”‚   â”‚                    â”‚                    â”‚                    â”‚            â”‚
    â”‚   â”‚   Guardian: Mom    â”‚                    â”‚   Guardian: Dad    â”‚            â”‚
    â”‚   â”‚   Billing: 60%     â”‚â—„â”€â”€â”€â”€ Student â”€â”€â”€â”€â–¶â”‚   Billing: 40%     â”‚            â”‚
    â”‚   â”‚   Pays: $16,500    â”‚       Alex        â”‚   Pays: $11,000    â”‚            â”‚
    â”‚   â”‚                    â”‚                    â”‚                    â”‚            â”‚
    â”‚   â”‚   Also:            â”‚                    â”‚   Also:            â”‚            â”‚
    â”‚   â”‚   Student: Emma    â”‚                    â”‚   Student: Emma    â”‚            â”‚
    â”‚   â”‚   (Same split)     â”‚                    â”‚   (Same split)     â”‚            â”‚
    â”‚   â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜                    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜            â”‚
    â”‚                                                                              â”‚
    â”‚   Key Relationships:                                                         â”‚
    â”‚   â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€                                                     â”‚
    â”‚   â€¢ household_students (many-to-many with billing_percentage)               â”‚
    â”‚   â€¢ Each household gets its own invoices                                    â”‚
    â”‚   â€¢ Student appears in both parent portals                                  â”‚
    â”‚                                                                              â”‚
    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

---

## ğŸ¯ Admissions Pipeline Flow

```
    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
    â”‚                        ADMISSIONS PIPELINE                                   â”‚
    â”‚                                                                              â”‚
    â”‚   â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”   â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”   â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”   â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”   â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”      â”‚
    â”‚   â”‚ INQUIRY â”‚â”€â”€â–¶â”‚  TOUR   â”‚â”€â”€â–¶â”‚ APPLIED â”‚â”€â”€â–¶â”‚ACCEPTED â”‚â”€â”€â–¶â”‚ENROLLED â”‚      â”‚
    â”‚   â””â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”˜   â””â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”˜   â””â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”˜   â””â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”˜   â””â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”˜      â”‚
    â”‚        â”‚             â”‚             â”‚             â”‚             â”‚            â”‚
    â”‚        â”‚             â”‚             â”‚             â”‚             â”‚            â”‚
    â”‚        â–¼             â–¼             â–¼             â–¼             â–¼            â”‚
    â”‚   â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”‚
    â”‚   â”‚                       ACTIVITY TIMELINE                              â”‚  â”‚
    â”‚   â”‚   ğŸ“§ Inquiry received                                                â”‚  â”‚
    â”‚   â”‚   ğŸ“ Follow-up call scheduled                                        â”‚  â”‚
    â”‚   â”‚   ğŸ« Tour completed                                                  â”‚  â”‚
    â”‚   â”‚   ğŸ“ Application submitted                                           â”‚  â”‚
    â”‚   â”‚   âœ… Application accepted                                            â”‚  â”‚
    â”‚   â”‚   ğŸ“„ Contract signed                                                 â”‚  â”‚
    â”‚   â”‚   ğŸ’³ Enrollment deposit paid                                         â”‚  â”‚
    â”‚   â”‚   ğŸ“ ENROLLED                                                        â”‚  â”‚
    â”‚   â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â”‚
    â”‚                                                                              â”‚
    â”‚   Lost leads tracked separately:                                            â”‚
    â”‚   â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”                                                              â”‚
    â”‚   â”‚  LOST   â”‚ â† Reason captured: cost, timing, location, etc.             â”‚
    â”‚   â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜                                                              â”‚
    â”‚                                                                              â”‚
    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

---

## ğŸ“ Application & Enrollment Flow

```
    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
    â”‚                    APPLICATION & ENROLLMENT FLOW                             â”‚
    â”‚                                                                              â”‚
    â”‚   Parent Portal                              Admin Dashboard                 â”‚
    â”‚   â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€                              â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€                 â”‚
    â”‚                                                                              â”‚
    â”‚   â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”                           â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”                 â”‚
    â”‚   â”‚   Submit    â”‚â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â–¶â”‚   Review    â”‚                 â”‚
    â”‚   â”‚ Application â”‚                           â”‚ Application â”‚                 â”‚
    â”‚   â””â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”˜                           â””â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”˜                 â”‚
    â”‚          â”‚                                         â”‚                        â”‚
    â”‚          â”‚   â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”      â”‚                        â”‚
    â”‚          â”‚   â”‚  Application Components       â”‚      â”‚                        â”‚
    â”‚          â”‚   â”‚  â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€   â”‚      â”‚                        â”‚
    â”‚          â”‚   â”‚  â€¢ Student info form          â”‚      â”‚                        â”‚
    â”‚          â”‚   â”‚  â€¢ Guardian info form         â”‚      â”‚                        â”‚
    â”‚          â”‚   â”‚  â€¢ File uploads (records)     â”‚      â”‚                        â”‚
    â”‚          â”‚   â”‚  â€¢ Essay questions            â”‚      â”‚                        â”‚
    â”‚          â”‚   â”‚  â€¢ Recommendation requests    â”‚      â”‚                        â”‚
    â”‚          â”‚   â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜      â”‚                        â”‚
    â”‚          â”‚                                         â”‚                        â”‚
    â”‚          â”‚                                         â–¼                        â”‚
    â”‚          â”‚                                  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”                 â”‚
    â”‚          â”‚                                  â”‚   Accept/   â”‚                 â”‚
    â”‚          â”‚                                  â”‚   Decline   â”‚                 â”‚
    â”‚          â”‚                                  â””â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”˜                 â”‚
    â”‚          â”‚                                         â”‚                        â”‚
    â”‚          â”‚â—€â”€â”€â”€â”€â”€â”€â”€â”€ Acceptance Email â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤                        â”‚
    â”‚          â”‚                                         â”‚                        â”‚
    â”‚          â–¼                                         â”‚                        â”‚
    â”‚   â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”                                  â”‚                        â”‚
    â”‚   â”‚    Sign     â”‚                                  â”‚                        â”‚
    â”‚   â”‚  Contract   â”‚â”€â”€â”€â”€â”€â”€ E-Signature â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â–¶â”‚                        â”‚
    â”‚   â””â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”˜                                  â”‚                        â”‚
    â”‚          â”‚                                         â”‚                        â”‚
    â”‚          â–¼                                         â”‚                        â”‚
    â”‚   â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”                                  â”‚                        â”‚
    â”‚   â”‚    Pay      â”‚                                  â”‚                        â”‚
    â”‚   â”‚  Deposit    â”‚â”€â”€â”€â”€â”€â”€ Stripe Payment â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â–¶â”‚                        â”‚
    â”‚   â””â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”˜                                  â”‚                        â”‚
    â”‚          â”‚                                         â”‚                        â”‚
    â”‚          â–¼                                         â–¼                        â”‚
    â”‚   â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”‚
    â”‚   â”‚                         ENROLLED                                     â”‚  â”‚
    â”‚   â”‚   â€¢ Contract on file                                                 â”‚  â”‚
    â”‚   â”‚   â€¢ Deposit paid                                                     â”‚  â”‚
    â”‚   â”‚   â€¢ Tuition plan selected                                           â”‚  â”‚
    â”‚   â”‚   â€¢ Auto-pay enrolled (optional)                                    â”‚  â”‚
    â”‚   â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â”‚
    â”‚                                                                              â”‚
    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

---

## ğŸ’³ Tuition & Billing Architecture

```
    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
    â”‚                     TUITION & BILLING SYSTEM                                 â”‚
    â”‚                                                                              â”‚
    â”‚   â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”   â”‚
    â”‚   â”‚                     HOUSEHOLD LEDGER                                 â”‚   â”‚
    â”‚   â”‚                                                                      â”‚   â”‚
    â”‚   â”‚   Date        Description              Charge     Payment   Balance  â”‚   â”‚
    â”‚   â”‚   â”€â”€â”€â”€â”€â”€â”€â”€    â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€     â”€â”€â”€â”€â”€â”€â”€â”€â”€  â”€â”€â”€â”€â”€â”€â”€â”€â”€  â”€â”€â”€â”€â”€â”€â”€ â”‚   â”‚
    â”‚   â”‚   08/01/24    Annual Tuition (Alex)    $27,500               $27,500 â”‚   â”‚
    â”‚   â”‚   08/01/24    Annual Tuition (Emma)    $25,000               $52,500 â”‚   â”‚
    â”‚   â”‚   08/01/24    Technology Fee           $500                  $53,000 â”‚   â”‚
    â”‚   â”‚   08/01/24    Sibling Discount         -$2,500               $50,500 â”‚   â”‚
    â”‚   â”‚   08/15/24    Enrollment Deposit                  $5,000     $45,500 â”‚   â”‚
    â”‚   â”‚   09/01/24    Monthly Payment #1                  $4,550     $40,950 â”‚   â”‚
    â”‚   â”‚   10/01/24    Monthly Payment #2                  $4,550     $36,400 â”‚   â”‚
    â”‚   â”‚   ...                                                                â”‚   â”‚
    â”‚   â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜   â”‚
    â”‚                                                                              â”‚
    â”‚   Tuition Plan Options:                                                      â”‚
    â”‚   â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€                                                     â”‚
    â”‚                                                                              â”‚
    â”‚   â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”   â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”   â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”                      â”‚
    â”‚   â”‚  ANNUAL     â”‚   â”‚   SEMESTER  â”‚   â”‚   MONTHLY   â”‚                      â”‚
    â”‚   â”‚             â”‚   â”‚             â”‚   â”‚             â”‚                      â”‚
    â”‚   â”‚  1 payment  â”‚   â”‚  2 payments â”‚   â”‚ 10 payments â”‚                      â”‚
    â”‚   â”‚  Aug 1      â”‚   â”‚  Aug + Jan  â”‚   â”‚  Aug - May  â”‚                      â”‚
    â”‚   â”‚             â”‚   â”‚             â”‚   â”‚             â”‚                      â”‚
    â”‚   â”‚  3% discountâ”‚   â”‚  1% discountâ”‚   â”‚  Full price â”‚                      â”‚
    â”‚   â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜   â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜   â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜                      â”‚
    â”‚                                                                              â”‚
    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

---

## ğŸ’° Stripe Payment Flow

```
    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
    â”‚                        STRIPE PAYMENT INTEGRATION                            â”‚
    â”‚                                                                              â”‚
    â”‚   Parent Portal                  Server                    Stripe            â”‚
    â”‚   â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€                 â”€â”€â”€â”€â”€â”€â”€â”€                   â”€â”€â”€â”€â”€â”€            â”‚
    â”‚                                                                              â”‚
    â”‚   â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”                                                           â”‚
    â”‚   â”‚ View Invoiceâ”‚                                                           â”‚
    â”‚   â””â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”˜                                                           â”‚
    â”‚          â”‚                                                                   â”‚
    â”‚          â”‚  "Pay Now"                                                       â”‚
    â”‚          â–¼                                                                   â”‚
    â”‚   â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”        â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”        â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”            â”‚
    â”‚   â”‚  Select     â”‚â”€â”€â”€â”€â”€â”€â”€â–¶â”‚   Create    â”‚â”€â”€â”€â”€â”€â”€â”€â–¶â”‚  Checkout   â”‚            â”‚
    â”‚   â”‚  Amount     â”‚        â”‚   Session   â”‚        â”‚   Session   â”‚            â”‚
    â”‚   â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜        â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜        â””â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”˜            â”‚
    â”‚                                                        â”‚                    â”‚
    â”‚          â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜                    â”‚
    â”‚          â”‚  Redirect to Stripe Checkout                                     â”‚
    â”‚          â–¼                                                                   â”‚
    â”‚   â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”                                                           â”‚
    â”‚   â”‚   Stripe    â”‚                                                           â”‚
    â”‚   â”‚   Payment   â”‚                                                           â”‚
    â”‚   â”‚    Page     â”‚                                                           â”‚
    â”‚   â””â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”˜                                                           â”‚
    â”‚          â”‚                                                                   â”‚
    â”‚          â”‚  Payment Complete                                                â”‚
    â”‚          â”‚                                                                   â”‚
    â”‚          â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”                                                  â”‚
    â”‚          â”‚               â”‚                                                  â”‚
    â”‚          â–¼               â–¼                                                  â”‚
    â”‚   â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”      â”‚
    â”‚   â”‚  Success    â”‚  â”‚  Webhook    â”‚â”€â–¶â”‚  Update     â”‚â”€â–¶â”‚   Send      â”‚      â”‚
    â”‚   â”‚   Page      â”‚  â”‚  Handler    â”‚  â”‚   Ledger    â”‚  â”‚  Receipt    â”‚      â”‚
    â”‚   â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜      â”‚
    â”‚                                                                              â”‚
    â”‚   Auto-Pay Flow:                                                            â”‚
    â”‚   â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€                                                            â”‚
    â”‚                                                                              â”‚
    â”‚   â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”      â”‚
    â”‚   â”‚   Inngest   â”‚â”€â–¶â”‚   Create    â”‚â”€â–¶â”‚   Charge    â”‚â”€â–¶â”‚   Update    â”‚      â”‚
    â”‚   â”‚  Scheduled  â”‚  â”‚   Invoice   â”‚  â”‚   Payment   â”‚  â”‚   Ledger    â”‚      â”‚
    â”‚   â”‚    Job      â”‚  â”‚             â”‚  â”‚   Method    â”‚  â”‚             â”‚      â”‚
    â”‚   â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜      â”‚
    â”‚                                                                              â”‚
    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

---

## ğŸ‘¥ User Authentication Flow (Magic Link)

```
    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
    â”‚                  MAGIC LINK AUTHENTICATION ARCHITECTURE                      â”‚
    â”‚                                                                              â”‚
    â”‚   â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”                                                        â”‚
    â”‚   â”‚  /login         â”‚ Guardian enters email                                 â”‚
    â”‚   â”‚  (email only)   â”‚â”€â”€â”€â”€â”€â”€â”                                                â”‚
    â”‚   â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜      â”‚                                                â”‚
    â”‚                            â–¼                                                â”‚
    â”‚                      â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”     â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”                    â”‚
    â”‚                      â”‚  Generate   â”‚â”€â”€â”€â”€â–¶â”‚   Send      â”‚                    â”‚
    â”‚                      â”‚  Token      â”‚     â”‚   via Brevo â”‚                    â”‚
    â”‚                      â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜     â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜                    â”‚
    â”‚                            â”‚                   â”‚                            â”‚
    â”‚                            â–¼                   â–¼                            â”‚
    â”‚                      â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”     â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”                    â”‚
    â”‚                      â”‚   Turso     â”‚     â”‚  ğŸ“§ Email   â”‚                    â”‚
    â”‚                      â”‚(magic_tokens)     â”‚  with link  â”‚                    â”‚
    â”‚                      â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜     â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜                    â”‚
    â”‚                                                â”‚                            â”‚
    â”‚                          Guardian clicks link  â”‚                            â”‚
    â”‚                                                â–¼                            â”‚
    â”‚                      â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”     â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”                    â”‚
    â”‚                      â”‚/auth/verify â”‚â”€â”€â”€â”€â–¶â”‚  Validate   â”‚                    â”‚
    â”‚                      â”‚  ?token=... â”‚     â”‚   Token     â”‚                    â”‚
    â”‚                      â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜     â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜                    â”‚
    â”‚                                                â”‚                            â”‚
    â”‚                         Valid & not expired?   â”‚                            â”‚
    â”‚                                                â–¼                            â”‚
    â”‚                      â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”     â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”                    â”‚
    â”‚                      â”‚  Find/Createâ”‚â”€â”€â”€â”€â–¶â”‚   Create    â”‚                    â”‚
    â”‚                      â”‚   Guardian  â”‚     â”‚   Session   â”‚                    â”‚
    â”‚                      â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜     â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜                    â”‚
    â”‚                                                â”‚                            â”‚
    â”‚                                                â–¼                            â”‚
    â”‚           â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”   â”‚
    â”‚           â”‚                                                              â”‚   â”‚
    â”‚           â–¼                                                              â–¼   â”‚
    â”‚   â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”                                            â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
    â”‚   â”‚  role=admin   â”‚                                            â”‚ role=guardian â”‚
    â”‚   â”‚               â”‚                                            â”‚               â”‚
    â”‚   â”‚  /admin/*     â”‚                                            â”‚  /portal/*    â”‚
    â”‚   â”‚  Full school  â”‚                                            â”‚  View studentsâ”‚
    â”‚   â”‚  management   â”‚                                            â”‚  Pay tuition  â”‚
    â”‚   â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜                                            â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
    â”‚                                                                              â”‚
    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

---

## ğŸ“§ Brevo Email Architecture

```
    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
    â”‚                          BREVO EMAIL FLOW                                    â”‚
    â”‚                                                                              â”‚
    â”‚   Event Triggers:                                                            â”‚
    â”‚   â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€                                                           â”‚
    â”‚                                                                              â”‚
    â”‚   â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”‚
    â”‚   â”‚Application  â”‚    â”‚  Enrollment â”‚    â”‚   Payment   â”‚    â”‚   Payment   â”‚  â”‚
    â”‚   â”‚  Accepted   â”‚    â”‚  Completed  â”‚    â”‚   Due Soon  â”‚    â”‚  Received   â”‚  â”‚
    â”‚   â””â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”˜    â””â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”˜    â””â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”˜    â””â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”˜  â”‚
    â”‚          â”‚                  â”‚                  â”‚                  â”‚          â”‚
    â”‚          â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜          â”‚
    â”‚                             â–¼                  â–¼                             â”‚
    â”‚                      â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”                        â”‚
    â”‚                      â”‚         Inngest             â”‚                        â”‚
    â”‚                      â”‚    (Event Orchestrator)     â”‚                        â”‚
    â”‚                      â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜                        â”‚
    â”‚                                    â”‚                                        â”‚
    â”‚                                    â–¼                                        â”‚
    â”‚                      â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”                        â”‚
    â”‚                      â”‚        Brevo API            â”‚                        â”‚
    â”‚                      â”‚  (Transactional Emails)     â”‚                        â”‚
    â”‚                      â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜                        â”‚
    â”‚                                    â”‚                                        â”‚
    â”‚              â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”                  â”‚
    â”‚              â–¼                     â–¼                     â–¼                  â”‚
    â”‚      â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”       â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”       â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”           â”‚
    â”‚      â”‚ Acceptance  â”‚       â”‚   Payment   â”‚       â”‚   Receipt   â”‚           â”‚
    â”‚      â”‚   Letter    â”‚       â”‚  Reminder   â”‚       â”‚             â”‚           â”‚
    â”‚      â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜       â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜       â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜           â”‚
    â”‚                                                                              â”‚
    â”‚   Email Templates (School-Specific):                                        â”‚
    â”‚   â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€                                       â”‚
    â”‚   â€¢ Application Received                                                    â”‚
    â”‚   â€¢ Application Accepted                                                    â”‚
    â”‚   â€¢ Application Waitlisted                                                  â”‚
    â”‚   â€¢ Contract Ready to Sign                                                  â”‚
    â”‚   â€¢ Enrollment Confirmed                                                    â”‚
    â”‚   â€¢ Payment Reminder (7 days before)                                        â”‚
    â”‚   â€¢ Payment Reminder (1 day before)                                         â”‚
    â”‚   â€¢ Payment Receipt                                                         â”‚
    â”‚   â€¢ Payment Failed                                                          â”‚
    â”‚   â€¢ Re-enrollment Invitation                                                â”‚
    â”‚                                                                              â”‚
    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

---

## âš¡ Inngest Event System Architecture

```
    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
    â”‚                        INNGEST EVENT SYSTEM                                  â”‚
    â”‚                                                                              â”‚
    â”‚   Event Sources:                                                             â”‚
    â”‚   â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€                                                            â”‚
    â”‚                                                                              â”‚
    â”‚   â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”                     â”‚
    â”‚   â”‚   Stripe    â”‚    â”‚   Admin     â”‚    â”‚   System    â”‚                     â”‚
    â”‚   â”‚  Webhook    â”‚    â”‚  Actions    â”‚    â”‚  Scheduled  â”‚                     â”‚
    â”‚   â””â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”˜    â””â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”˜    â””â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”˜                     â”‚
    â”‚          â”‚                  â”‚                  â”‚                            â”‚
    â”‚          â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜                            â”‚
    â”‚                             â–¼                                               â”‚
    â”‚                      â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”                        â”‚
    â”‚                      â”‚     inngest.send()          â”‚                        â”‚
    â”‚                      â”‚   Event Dispatcher          â”‚                        â”‚
    â”‚                      â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜                        â”‚
    â”‚                                    â”‚                                        â”‚
    â”‚                                    â–¼                                        â”‚
    â”‚                      â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”                        â”‚
    â”‚                      â”‚     /api/inngest            â”‚                        â”‚
    â”‚                      â”‚   Function Handler          â”‚                        â”‚
    â”‚                      â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜                        â”‚
    â”‚                                    â”‚                                        â”‚
    â”‚          â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”              â”‚
    â”‚          â–¼                         â–¼                         â–¼              â”‚
    â”‚   â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”          â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”          â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”        â”‚
    â”‚   â”‚ Application â”‚          â”‚   Payment   â”‚          â”‚ Re-Enroll   â”‚        â”‚
    â”‚   â”‚  Accepted   â”‚          â”‚   Reminder  â”‚          â”‚  Campaign   â”‚        â”‚
    â”‚   â”‚  Function   â”‚          â”‚  Function   â”‚          â”‚  Function   â”‚        â”‚
    â”‚   â””â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”˜          â””â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”˜          â””â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”˜        â”‚
    â”‚          â”‚                        â”‚                        â”‚                â”‚
    â”‚          â”‚   â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜                â”‚
    â”‚          â”‚   â”‚                                                              â”‚
    â”‚          â–¼   â–¼                                                              â”‚
    â”‚   â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”                                          â”‚
    â”‚   â”‚   step.run() / step.sleep() â”‚                                          â”‚
    â”‚   â”‚   Durable execution steps   â”‚                                          â”‚
    â”‚   â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜                                          â”‚
    â”‚                 â”‚                                                           â”‚
    â”‚          â”Œâ”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”                                                   â”‚
    â”‚          â–¼             â–¼                                                   â”‚
    â”‚   â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”                                          â”‚
    â”‚   â”‚   Brevo     â”‚ â”‚   Database  â”‚                                          â”‚
    â”‚   â”‚   (Email)   â”‚ â”‚   (Update)  â”‚                                          â”‚
    â”‚   â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜                                          â”‚
    â”‚                                                                              â”‚
    â”‚   School-Specific Events:                                                   â”‚
    â”‚   â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€                                                 â”‚
    â”‚   â€¢ school/application.submitted                                            â”‚
    â”‚   â€¢ school/application.accepted                                             â”‚
    â”‚   â€¢ school/enrollment.completed                                             â”‚
    â”‚   â€¢ school/payment.due                                                      â”‚
    â”‚   â€¢ school/payment.received                                                 â”‚
    â”‚   â€¢ school/payment.failed                                                   â”‚
    â”‚   â€¢ school/reenrollment.window-open                                         â”‚
    â”‚                                                                              â”‚
    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

---

## ğŸ—„ï¸ Database Layer: Drizzle + Turso

### Directory Structure

```
src/
â”œâ”€â”€ db/
â”‚   â”œâ”€â”€ index.ts              # Database client initialization
â”‚   â”œâ”€â”€ schema/
â”‚   â”‚   â”œâ”€â”€ index.ts          # Export all schemas
â”‚   â”‚   â”œâ”€â”€ households.ts     # Household (billing unit)
â”‚   â”‚   â”œâ”€â”€ guardians.ts      # Parents/guardians
â”‚   â”‚   â”œâ”€â”€ students.ts       # Students
â”‚   â”‚   â”œâ”€â”€ household-students.ts  # Many-to-many with billing %
â”‚   â”‚   â”œâ”€â”€ addresses.ts      # Billing/mailing addresses
â”‚   â”‚   â”œâ”€â”€ leads.ts          # Admissions pipeline leads
â”‚   â”‚   â”œâ”€â”€ applications.ts   # Submitted applications
â”‚   â”‚   â”œâ”€â”€ enrollments.ts    # Active enrollments per year
â”‚   â”‚   â”œâ”€â”€ tuition-plans.ts  # Payment plan configuration
â”‚   â”‚   â”œâ”€â”€ ledger.ts         # All charges and payments
â”‚   â”‚   â”œâ”€â”€ payment-methods.ts # Saved cards/bank accounts
â”‚   â”‚   â”œâ”€â”€ contracts.ts      # Signed enrollment contracts
â”‚   â”‚   â”œâ”€â”€ documents.ts      # Uploaded files
â”‚   â”‚   â”œâ”€â”€ magic-tokens.ts   # Magic link auth tokens
â”‚   â”‚   â”œâ”€â”€ sessions.ts       # User sessions
â”‚   â”‚   â””â”€â”€ activity-log.ts   # Audit trail
â”‚   â””â”€â”€ migrations/           # Auto-generated migration files
â”œâ”€â”€ lib/
â”‚   â”œâ”€â”€ auth.ts               # Authentication utilities
â”‚   â”œâ”€â”€ magic-link.ts         # Magic link generation & verification
â”‚   â”œâ”€â”€ brevo.ts              # Brevo email client
â”‚   â””â”€â”€ inngest.ts            # Inngest event functions
â”œâ”€â”€ drizzle.config.ts         # Drizzle Kit configuration
â””â”€â”€ ...
```

### Core Schema Relationships

```typescript
// ğŸ  Household - The billing unit
households
  â”œâ”€â”€ id
  â”œâ”€â”€ name (e.g., "Smith Family")
  â”œâ”€â”€ stripe_customer_id
  â”œâ”€â”€ created_at
  â””â”€â”€ updated_at

// ğŸ‘¨â€ğŸ‘©â€ğŸ‘§ Guardians - Parents who can log in
guardians
  â”œâ”€â”€ id
  â”œâ”€â”€ household_id (primary household)
  â”œâ”€â”€ email (login credential)
  â”œâ”€â”€ first_name
  â”œâ”€â”€ last_name
  â”œâ”€â”€ phone
  â”œâ”€â”€ relationship (parent, guardian, grandparent)
  â”œâ”€â”€ role (guardian, admin)
  â””â”€â”€ created_at

// ğŸ’ Students - The children
students
  â”œâ”€â”€ id
  â”œâ”€â”€ first_name
  â”œâ”€â”€ last_name
  â”œâ”€â”€ date_of_birth
  â”œâ”€â”€ current_grade
  â”œâ”€â”€ created_at
  â””â”€â”€ updated_at

// ğŸ”— Household-Student relationship (supports split custody)
household_students
  â”œâ”€â”€ household_id
  â”œâ”€â”€ student_id
  â”œâ”€â”€ billing_percentage (0-100, must sum to 100 per student)
  â””â”€â”€ is_primary (for communications)

// ğŸ“’ Ledger - Financial transactions
ledger_entries
  â”œâ”€â”€ id
  â”œâ”€â”€ household_id
  â”œâ”€â”€ student_id (optional, for student-specific charges)
  â”œâ”€â”€ type (charge, payment, credit, adjustment)
  â”œâ”€â”€ description
  â”œâ”€â”€ amount (positive for charges, negative for payments)
  â”œâ”€â”€ balance_after
  â”œâ”€â”€ stripe_payment_id (if payment)
  â”œâ”€â”€ school_year
  â””â”€â”€ created_at
```

---

## ğŸ” Turso Setup Instructions

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  TURSO SETUP WIZARD                                          â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                                                               â”‚
â”‚  Step 1: Install Turso CLI                                   â”‚
â”‚  â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€                         â”‚
â”‚  brew install tursodatabase/tap/turso                        â”‚
â”‚                                                               â”‚
â”‚  Step 2: Authenticate                                        â”‚
â”‚  â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€                         â”‚
â”‚  turso auth signup     # If you're new                       â”‚
â”‚  turso auth login      # If you have an account              â”‚
â”‚                                                               â”‚
â”‚  Step 3: Create a Database                                   â”‚
â”‚  â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€                         â”‚
â”‚  turso db create school-platform                             â”‚
â”‚                                                               â”‚
â”‚  Step 4: Get Your Credentials                                â”‚
â”‚  â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€                         â”‚
â”‚  turso db show school-platform --url                         â”‚
â”‚  # Output: libsql://school-platform-username.turso.io        â”‚
â”‚                                                               â”‚
â”‚  turso db tokens create school-platform                      â”‚
â”‚  # Output: eyJhbGciOiJFZERTQSIsInR5cCI6IkpXVC...             â”‚
â”‚                                                               â”‚
â”‚  Step 5: Add to Environment                                  â”‚
â”‚  â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€                         â”‚
â”‚  TURSO_DATABASE_URL=libsql://school-platform-user.turso.io   â”‚
â”‚  TURSO_AUTH_TOKEN=eyJhbGciOiJFZERTQSIsInR5cCI6IkpXVC...      â”‚
â”‚                                                               â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

### Local Development Option

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  LOCAL SQLITE (for offline development)                       â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                                                               â”‚
â”‚  For local development without Turso, you can use:           â”‚
â”‚                                                               â”‚
â”‚  TURSO_DATABASE_URL=file:./local.db                          â”‚
â”‚  # No auth token needed for local files                      â”‚
â”‚                                                               â”‚
â”‚  This creates a local SQLite file for testing.               â”‚
â”‚  Switch to Turso URL when deploying!                         â”‚
â”‚                                                               â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

---

## ğŸ’³ Stripe Setup Guide

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  STRIPE SETUP FOR SCHOOL PAYMENTS                             â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                                                               â”‚
â”‚  Step 1: Create Stripe Account                                â”‚
â”‚  â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€                         â”‚
â”‚  1. Go to https://dashboard.stripe.com                        â”‚
â”‚  2. Sign up or log in                                         â”‚
â”‚  3. Complete account verification                             â”‚
â”‚                                                               â”‚
â”‚  Step 2: Get API Keys                                         â”‚
â”‚  â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€                         â”‚
â”‚  1. Go to Developers â†’ API Keys                               â”‚
â”‚  2. Copy "Publishable key" â†’ STRIPE_PUBLIC_KEY               â”‚
â”‚  3. Copy "Secret key" â†’ STRIPE_SECRET_KEY                    â”‚
â”‚  Note: Use test keys (pk_test_, sk_test_) for development    â”‚
â”‚                                                               â”‚
â”‚  Step 3: Set Up Webhooks (Local Development)                  â”‚
â”‚  â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€                         â”‚
â”‚  1. Install Stripe CLI: brew install stripe/stripe-cli/stripe â”‚
â”‚  2. Login: stripe login                                       â”‚
â”‚  3. Forward webhooks:                                         â”‚
â”‚     stripe listen --forward-to localhost:3000/api/stripe/webhook
â”‚  4. Copy the webhook signing secret â†’ STRIPE_WEBHOOK_SECRET  â”‚
â”‚                                                               â”‚
â”‚  Step 4: Configure for Tuition                                â”‚
â”‚  â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€                         â”‚
â”‚  1. Enable ACH payments (Developers â†’ Settings)               â”‚
â”‚  2. Set up recurring billing if using Stripe Billing          â”‚
â”‚  3. Configure payment retry logic                             â”‚
â”‚                                                               â”‚
â”‚  Required Webhooks:                                           â”‚
â”‚  â€¢ checkout.session.completed                                 â”‚
â”‚  â€¢ payment_intent.succeeded                                   â”‚
â”‚  â€¢ payment_intent.payment_failed                              â”‚
â”‚  â€¢ invoice.paid (if using Stripe Invoicing)                   â”‚
â”‚  â€¢ customer.subscription.updated (if using subscriptions)     â”‚
â”‚                                                               â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

---

## ğŸ“§ Brevo Setup Guide

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  BREVO EMAIL SETUP FOR SCHOOLS                                â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                                                               â”‚
â”‚  Brevo handles all school communications:                     â”‚
â”‚  â€¢ Application status emails                                  â”‚
â”‚  â€¢ Enrollment confirmations                                   â”‚
â”‚  â€¢ Payment reminders and receipts                             â”‚
â”‚  â€¢ Re-enrollment invitations                                  â”‚
â”‚                                                               â”‚
â”‚  Step 1: Create Brevo Account                                 â”‚
â”‚  â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€                         â”‚
â”‚  1. Go to https://www.brevo.com                               â”‚
â”‚  2. Sign up (free tier: 300 emails/day)                       â”‚
â”‚  3. Verify your email address                                 â”‚
â”‚                                                               â”‚
â”‚  Step 2: Get API Key                                          â”‚
â”‚  â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€                         â”‚
â”‚  1. Go to Settings â†’ API Keys (or SMTP & API)                 â”‚
â”‚  2. Click "Generate a new API key"                            â”‚
â”‚  3. Name it (e.g., "School Platform")                         â”‚
â”‚  4. Copy immediately â†’ BREVO_API_KEY                         â”‚
â”‚     (Only shown once!)                                        â”‚
â”‚                                                               â”‚
â”‚  Step 3: Configure Sender                                     â”‚
â”‚  â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€                         â”‚
â”‚  1. Go to Settings â†’ Senders & IP                             â”‚
â”‚  2. Add sender email (e.g., admissions@yourschool.edu)        â”‚
â”‚  3. Verify the domain or email address                        â”‚
â”‚                                                               â”‚
â”‚  Step 4: Create Email Templates                               â”‚
â”‚  â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€                         â”‚
â”‚  Create these templates in Brevo dashboard:                   â”‚
â”‚  â€¢ Template 1: Application Received                           â”‚
â”‚  â€¢ Template 2: Application Accepted                           â”‚
â”‚  â€¢ Template 3: Contract Ready                                 â”‚
â”‚  â€¢ Template 4: Enrollment Confirmed                           â”‚
â”‚  â€¢ Template 5: Payment Reminder                               â”‚
â”‚  â€¢ Template 6: Payment Receipt                                â”‚
â”‚  â€¢ Template 7: Payment Failed                                 â”‚
â”‚  â€¢ Template 8: Re-enrollment Invitation                       â”‚
â”‚  Note template IDs and update src/lib/brevo.ts               â”‚
â”‚                                                               â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

---

## âš¡ Inngest Setup Guide

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  INNGEST SETUP - School Event Workflows                       â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                                                               â”‚
â”‚  Inngest handles async school operations:                     â”‚
â”‚  â€¢ Payment reminder sequences                                 â”‚
â”‚  â€¢ Application status notifications                           â”‚
â”‚  â€¢ Re-enrollment campaigns                                    â”‚
â”‚  â€¢ Scheduled billing automation                               â”‚
â”‚                                                               â”‚
â”‚  Step 1: Create Inngest Account                               â”‚
â”‚  â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€                         â”‚
â”‚  1. Go to https://www.inngest.com                             â”‚
â”‚  2. Sign up (generous free tier)                              â”‚
â”‚  3. Create a new app                                          â”‚
â”‚                                                               â”‚
â”‚  Step 2: Get Keys                                             â”‚
â”‚  â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€                         â”‚
â”‚  1. Go to your app's settings                                 â”‚
â”‚  2. Copy Signing Key â†’ INNGEST_SIGNING_KEY                   â”‚
â”‚  3. Copy Event Key â†’ INNGEST_EVENT_KEY                       â”‚
â”‚                                                               â”‚
â”‚  Step 3: Local Development                                    â”‚
â”‚  â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€                         â”‚
â”‚  Run the Inngest dev server alongside your app:               â”‚
â”‚                                                               â”‚
â”‚  npx inngest-cli@latest dev                                   â”‚
â”‚                                                               â”‚
â”‚  This opens http://localhost:8288 for testing                 â”‚
â”‚  No signing key needed for local dev!                         â”‚
â”‚                                                               â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

---

## ğŸš€ App Startup Sequence

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  BOOT SEQUENCE                                               â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                                                              â”‚
â”‚  1. Check environment variables                              â”‚
â”‚     â”œâ”€â”€ TURSO_*, STRIPE_*, BREVO_*, INNGEST_*, SESSION_*   â”‚
â”‚     â”œâ”€â”€ If missing: Redirect to /install                    â”‚
â”‚     â””â”€â”€ If present: Continue                                â”‚
â”‚                                                              â”‚
â”‚  2. Initialize Turso connection                              â”‚
â”‚     â”œâ”€â”€ If fails: Show database error                       â”‚
â”‚     â””â”€â”€ If success: Run pending migrations                  â”‚
â”‚                                                              â”‚
â”‚  3. Verify Stripe connection                                 â”‚
â”‚     â”œâ”€â”€ If fails: Block admin billing features              â”‚
â”‚     â””â”€â”€ If success: Continue                                â”‚
â”‚                                                              â”‚
â”‚  4. Initialize Brevo client                                  â”‚
â”‚     â”œâ”€â”€ If fails: Log warning (non-blocking)               â”‚
â”‚     â””â”€â”€ If success: Email ready                             â”‚
â”‚                                                              â”‚
â”‚  5. Register Inngest functions                               â”‚
â”‚     â”œâ”€â”€ /api/inngest endpoint available                     â”‚
â”‚     â””â”€â”€ All event handlers ready                            â”‚
â”‚                                                              â”‚
â”‚  6. Ready to serve! ğŸ“                                       â”‚
â”‚                                                              â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

---

## ğŸ”„ Server Functions (TanStack Start)

```typescript
// The patterns we'll use throughout

// ğŸ¯ Pattern 1: Data Fetching (Public)
export const getSchoolInfo = createServerFn({ method: 'GET' })
  .handler(async () => {
    return db.select().from(school).limit(1);
  });

// ğŸ¯ Pattern 2: Protected Guardian Actions
export const getMyStudents = createServerFn({ method: 'GET' })
  .handler(async () => {
    const guardian = await requireGuardian();
    return db.query.students.findMany({
      where: inArray(students.householdId, guardian.householdIds),
    });
  });

// ğŸ¯ Pattern 3: Admin Only Actions
export const updateApplicationStatus = createServerFn({ method: 'POST' })
  .validator(applicationStatusSchema)
  .handler(async ({ data }) => {
    await requireAdmin();
    return db.update(applications)
      .set({ status: data.status })
      .where(eq(applications.id, data.applicationId))
      .returning();
  });

// ğŸ¯ Pattern 4: Mutations with Validation
export const submitApplication = createServerFn({ method: 'POST' })
  .validator(applicationSchema)
  .handler(async ({ data }) => {
    const guardian = await requireGuardian();
    // Verify guardian owns this student
    // Insert application
    // Trigger Inngest event
    return db.insert(applications).values(data).returning();
  });
```

---

## ğŸ” Session Secret

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  SESSION_SECRET                                               â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                                                               â”‚
â”‚  Generate a random 32+ character string:                      â”‚
â”‚                                                               â”‚
â”‚  Option 1: Use OpenSSL                                        â”‚
â”‚  openssl rand -base64 32                                      â”‚
â”‚                                                               â”‚
â”‚  Option 2: Use Node.js                                        â”‚
â”‚  node -e "console.log(require('crypto').randomBytes(32).toString('hex'))"
â”‚                                                               â”‚
â”‚  Add to environment:                                          â”‚
â”‚  SESSION_SECRET=your-random-string-here                       â”‚
â”‚                                                               â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

---

*"In my database, there are no records. Only dreams... and households, and students, and tuition payments."* - Ralph, probably
